
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% University Assignment Title Page 
% LaTeX Template
% Version 1.0 (27/12/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% WikiBooks (http://en.wikibooks.org/wiki/LaTeX/Title_Creation)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
% 
% Instructions for using this template:
% This title page is capable of being compiled as is. This is not useful for 
% including it in another document. To do this, you have two options: 
%
% 1) Copy/paste everything between \begin{document} and \end{document} 
% starting at \begin{titlepage} and paste this into another LaTeX file where you 
% want your title page.
% OR
% 2) Remove everything outside the \begin{titlepage} and \end{titlepage} and 
% move this file to the same directory as the LaTeX file you wish to add it to. 
% Then add \input{./title_page_1.tex} to your LaTeX file where you want your
% title page.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\title{Title page with logo}
%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[12pt]{article}
\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}

% My Packpage 
\usepackage{glossaries}
\usepackage{bm}
\usepackage{mathtools}
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}
\newglossaryentry{latex}
{
    name=latex,
    description={Is a mark up language specially suited 
    for scientific documents}
}
\newacronym{gcd}{GCD}{Greatest Common Divisor}
\makeglossaries
\begin{document}
\begin{titlepage}
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here
\center % Center everything on the page
\textsc{\LARGE The University of California, Los Angeles}\\[1.5cm] % Name of your university/college
\textsc{\Large Robotics Design Capstone}\\[0.5cm] % Major heading such as course name
\textsc{\large EE 183DB }\\[0.5cm] % Minor heading such as course title
\HRule \\[0.4cm]
{ \huge \bfseries Off-center spinning mass controller for Quadcopters}\\[0.4cm] % Title of your document
\HRule \\[1.5cm]
\begin{minipage}{0.4\textwidth}
\begin{flushleft} \large
\emph{Author:}\\
Lin \textsc{Li} % Your name
\\
Angel \textsc{Jimenez} % Your name
\\
Wilson \textsc{Chang} % Your name
\\
Amirali \textsc{Omidfar} % Your name
\end{flushleft}
\end{minipage}
~
\begin{minipage}{0.4\textwidth}
\begin{flushright} \large
\emph{Professor:} \\
Ankur \textsc{Metha} % Supervisor's Name
\end{flushright}
\end{minipage}\\[1cm]
{\large \today}\\[1cm] % Date, change the \today to a set date if you want to be precise
\includegraphics[scale=0.2]{UCLA_Logo.png}\\[1cm] % Include a department/university logo - this will require the graphicx package
%----------------------------------------------------------------------------------------
\vfill % Fill the rest of the page with whitespace
\end{titlepage}
\begin{abstract}
Your abstract.
\end{abstract}
\section{Symbols}
Here is a list of all symbols used in this paper:
\\
\begin{tabular}{c p{1\textwidth}}
  $\bm{p} = \begin{bmatrix}x \\ y \\ z \end{bmatrix}$ & linear position vectors \\
  $\bm{q} = \begin{bmatrix} q_r \\ q_i \\ q_j \\ q_k \end{bmatrix}$ & angular orientation vectors in quaternion \\
  $\bm{F_{T}}$ & thrust force \\
  $\bm{F_{G}}$ & gravitational force \\  
  $\bm{F_{S}}$ & reaction force acted on the surface \\
  $\bm{\tau_{S}}$ & reaction torque acted on the surface \\
  $\bm{\tau_{M}}$ & torque introduced by the off-center mass \\
  $m_b$ & mass of the body \\
  $m_c$ & mass of the controller \\
  $S_x, C_x, T_x$ & $\sin(x), \cos(x), \tan(x)$ respectively \\
\end{tabular}\\
% \\ \\ \\ \\ \\ \\
% \newpage
\section{Mathematical Derivation}

\subsection{Assumptions}
\begin{itemize}
\item Assume unit quaternions: $||\bm{q}|| = 1$
\end{itemize}

\subsection{Quadcopter Body Dynamics}
Forces and Torques:
\begin{align*}
  \prescript{B}{}{\bm{F_{TB}}} &=
  \begin{bmatrix}
    0 \\ 0 \\ F_{TB}
  \end{bmatrix} \\
  \prescript{O}{}{\bm{F_{GB}}} &=
  \begin{bmatrix}
    0 \\ 0 \\ -m_b g
  \end{bmatrix} \\
  \prescript{B}{}{\bm{F_{SB}}} &=
  \begin{bmatrix}
    F_{SBx} \\ F_{SBy} \\ F_{SBz} 
  \end{bmatrix} \\
  \prescript{B}{}{\bm{\tau_{SB}}} &=
  \begin{bmatrix}
    \tau_{SBx} \\ \tau_{SBy} \\ \tau_{SBz} 
  \end{bmatrix}
\end{align*}
The Quaternion-derived Rotation matrix is defined as follow,
\begin{align*}
  \prescript{O}{B}{R} = R(\bm{q_B}) =
  \begin{bmatrix}
    q_r^2 + q_i^2 - q_j^2 - q_k^2 & 2q_iq_j - 2q_rq_k & 2q_iq_k + 2q_rq_j \\
    2q_iq_j + 2q_rq_k & q_r^2 - q_i^2 + q_j^2 - q_k^2 & 2q_jq_k - 2q_rq_i \\
    2q_iq_k - 2q_rq_j & 2q_jq_k + 2q_rq_i & q_r^2 - q_i^2 - q_j^2 +q_k^2
  \end{bmatrix}
\end{align*}
Net Force
\begin{align*}
  \prescript{O}{}{\bm{F_{B, net}}} &= \prescript{O}{}{\bm{F_{GB}}} + \prescript{O}{}{\bm{F_{TB}}} + \prescript{O}{}{\bm{F_{SB}}} = m_B \prescript{O}{}{\bm{a_B}} \\
  \prescript{O}{}{\bm{F_{GB}}} + \prescript{O}{B}{R} \prescript{B}{}{\bm{F_{TB}}} + \prescript{O}{B}{R} \prescript{B}{}{\bm{F_{SB}}} &= m_B \bm{a_B} = m_B \prescript{O}{}{\bm{\ddot{p}_B}}
\end{align*}
Net Torque
\begin{align*}
  \prescript{O}{}{\bm{\tau_{B, net}}} &= I_B \prescript{O}{}{\bm{\alpha_B}} \\
  \prescript{O}{B}{R} \prescript{B}{}{\bm{\tau_{SB}}} &= 2I_B(\bm{\ddot{q}_B} \bm{q_B} - (\bm{\dot{q}_B} \bm{q}_B)^2)
\end{align*}
By appling Physics law, we arrive at two equations below,
\begin{align}
  \prescript{O}{}{\bm{F_{GB}}} + R(\bm{q_B}) \prescript{B}{}{\bm{F_{T}}} + R(\bm{q_B}) \prescript{B}{}{\bm{F_{CB}}} &= m_B \prescript{O}{}{\bm{{a}_B}} \\  
  R(\bm{q_B}) \prescript{B}{}{\bm{\tau_{CB}}} &= 2\prescript{O}{}{I_B}(\bm{\prescript{O}{}{\alpha_{B}}})  
\end{align}
with $\prescript{O}{}{\bm{F_{T}}} = R(\bm{q_B}) \prescript{B}{}{\bm{F_{T}}}, \quad
\prescript{O}{}{\bm{F_{CB}}} = R(\bm{q_B}) \prescript{B}{}{\bm{F_{CB}}}, \quad
\prescript{O}{}{\bm{\tau_{CB}}} = R(\bm{q_B}) \prescript{B}{}{\bm{\tau_{T}}}, \quad \\
\prescript{O}{}{I_{B}}= R(\bm{q_B}) \prescript{B}{}{I_{B}} R^{-1}(\bm{q_B}), \quad
$
We then aim to find the state evolution equation for the body from the above equations (1) and (2), namely
\begin{equation}
  \bm{\dot{s}_B} = f_B(\bm{s}_B, \bm{F_{B, net}}, \bm{\tau_{B, net}})
\end{equation}
Let $\bm{v_B} = \bm{\dot{p}_B}$ and $\bm{\omega_B} = \bm{\dot{q}_B}$ and substitute new variables,
\begin{align*}
  \bm{\dot{p}_B} &= \bm{v_B} \\
  \bm{\dot{v}_B} &= \frac{1}{m_B} \left[R(\bm{q_B})\prescript{B}{}{\bm{F_{TB}}} + R(\bm{q_B}) \prescript{B}{}{\bm{F_{SB}}} + \prescript{O}{}{\bm{F_{GB}}}\right] \\
  \bm{\dot{q}_B} &= \bm{\omega{_B}} \\
  \bm{\dot{\omega}_B} &= \left[ \frac{R(\bm{q_B}) \bm{\bm{\tau_{SB}}}}{2I_B} + {(\bm{\omega_B} \bm{{q^*_B})}}^2 \right] \bm{q_B}
\end{align*}
Then, by letting our state variable $\bm{s_B} =
\begin{bmatrix}
  \bm{p_B} \\
  \bm{v_B} \\
  \bm{q_B} \\
  \bm{\omega_B}
\end{bmatrix}
$, we arrive at the desired state evolution equation.


\subsection{Controller Dynamics}
Similarly as above we aim to find the state evolution equation for the controller from equations we got from Physics law, namely
\begin{equation}
  \bm{\dot{s}_C} = f_C(\bm{s}_C, \bm{F_{C, net}}, \bm{\tau_{C, net}})
\end{equation}
Forces and Torques:
\begin{align*}
  \prescript{C}{}{\bm{F_{SC}}} &=
  \begin{bmatrix}
    F_{SCx} \\ F_{SCy} \\ F_{SCz}
  \end{bmatrix} \\
  \prescript{O}{}{\bm{F_{GC}}} &=
  \begin{bmatrix}
    0 \\ 0 \\ -m_c g
  \end{bmatrix} \\
  \prescript{B}{}{\bm{\tau_{SC}}} &=
  \begin{bmatrix}
    \tau_{SCx} \\ \tau_{SCy} \\ \tau_{SCz} 
  \end{bmatrix} \\
  \prescript{}{O}{\bm{\tau_{M}}} &= \prescript{O}{}{\bm{r_M}} \times \prescript{O}{}{\bm{F_{GC}}} = \prescript{O}{B}{R} \prescript{B}{}{\bm{r_M}} \times \prescript{O}{}{\bm{F_{GC}}} \\
                               &= R(q_C) 
                                 \begin{bmatrix}
                                   L_{Mx} \\ 0 \\ L_{Mz}
                                 \end{bmatrix} \times
  \begin{bmatrix}
    0 \\ 0 \\ -m_c g
  \end{bmatrix}
\end{align*}
Net Force and Net Torque:
\begin{align*}
  m_c \bm{\ddot{p}_C} = \prescript{O}{}{F_{GC}} + \prescript{O}{C}{R} \prescript{B}{}{\bm{F_{SC}}} \\
  I_c \bm{\alpha_C} = \prescript{O}{C}{R} \prescript{O}{}{\tau_{SC}} + \prescript{O}{}{\bm{\tau_{M}}} 
\end{align*}

Let $\bm{v_C} = \bm{\dot{p}_C}$ and $\bm{\omega_C} = \bm{\dot{q}_C}$ and substitute new variables,
\begin{align*}
  \bm{\dot{p}_C} &= \bm{v_C} \\
  \bm{\dot{v}_C} &= \frac{1}{m_C} \left[R(\bm{q_C})\prescript{B}{}{\bm{F_{SC}}} + \prescript{O}{}{\bm{F_{GC}}}\right] \\
  \bm{\dot{q}_C} &= \bm{\omega_C} \\
  \bm{\dot{\omega}_C} &= \left[ \frac{R(\bm{q_C}) \prescript{B}{}{\bm{\tau_{SC}}} + \prescript{O}{}{\bm{\tau_M(\bm{q_C})}}}{2I_C} + {(\bm{\omega_C} \bm{{q^*_C})}}^2 \right] \bm{q_C}
\end{align*}
Then, by letting our state variable $\bm{s_C} =
\begin{bmatrix}
  \bm{p_C} \\
  \bm{v_C} \\
  \bm{q_C} \\
  \bm{\omega_C}
\end{bmatrix}
$, we arrive at the desired state evolution equation.
\subsection{Constraints and Manipulation}
The two bodies are contrainted (attached together), there are some relationship between the states and the forces between the body and the controller, 
\begin{align}
  \bm{s_C} &= f_{BC}(\bm{s_B}) \\
  \bm{F_C} &= g_{BC,F}(\bm{F_B}) \\
  \bm{\tau_C} &= g_{BC,\tau}(\bm{\tau_B})
\end{align}
Combining the above equations with (3) and (4), we would like to do some algebraic manipulation to get rid of the unwanted parameters in our state evolution equations, such that
\begin{align*}
  \bm{\dot{s}_{sys}} = f_{sys}(\bm{s_{sys}}, \bm{u})
\end{align*}
with u being our input, whatever we defined our input to be, either being the yaw torque in the body frame $\tau_{SBz}$ or some other representations.
\end{document}